<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>語音播報功能</title>
		<style>
			article {margin: 0 auto;max-width: 800px;text-align: center;}
			textarea {max-width: 600px;width:100%;text-align: left;}
			button{border-radius: 3px;border: 1px solid #dddddd;height: 30px;width: 80px;cursor: pointer;}
		</style>
	</head>

	<body>
		<article>
			<h3 align="center">語音播報功能：</h3>
			<p>
				<textarea rows="15" class="_play">測試</textarea>
			</p>
			<p>
				<label>選擇播報語言：</label>
				<select id="voiceSelect" onchange="play()"></select>
			</p>
			<button class="_search" onclick="play()">開始</button>
			<button onclick="resume()">繼續</button>
			<button onclick="pause()">暂停</button>
			<button onclick="cancel()">清除</button>
		</article>
	</body>
	<script>
		if(!('speechSynthesis' in window)) {
			throw alert("您的瀏覽器不支持")
		}

		var _play = document.querySelector("._play"),
			to_speak = window.speechSynthesis,
			dataName, voiceSelect = document.querySelector("#voiceSelect"),
			voices = [];

		function play() {
			cancel();
			to_speak = new SpeechSynthesisUtterance(_play.value);

			//to_speak.rate = 1.4;// 设置播放语速，范围：0.1 - 10之间

			var selectedOption = voiceSelect.selectedOptions[0].getAttribute('data-name');
			for(i = 0; i < voices.length; i++) {
				if(voices[i].name === selectedOption) {
					to_speak.voice = voices[i];
				}
			}

			window.speechSynthesis.speak(to_speak);

		}

		//暂停
		function pause() {
			window.speechSynthesis.pause();
		}
		//继续播放
		function resume() {
			window.speechSynthesis.resume(); //继续
		}
		//清除所有语音播报创建的队列
		function cancel() {
			window.speechSynthesis.cancel();
		}
		//创建选择语言的select标签
		function populateVoiceList() {
			voices = speechSynthesis.getVoices();
			for(i = 0; i < voices.length; i++) {
				var option = document.createElement('option');
				option.textContent = voices[i].name + ' (' + voices[i].lang + ')';

				if(voices[i].default) {
					option.textContent += ' -- DEFAULT';
				}
				option.setAttribute('data-lang', voices[i].lang);
				option.setAttribute('data-name', voices[i].name);
				voiceSelect.appendChild(option);
			}
		}

		setTimeout(function() {
			populateVoiceList();
		}, 0)
	</script>

</html>